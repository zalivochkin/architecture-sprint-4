Мотивация

Добавление системы трейсинга преследует следующие цели:
1. Решить проблему зависания заказов
2. Решить проблему с неэффективностью при поиске и устранении ошибок в системе
3. Повысить надёжность и производительность системы
4. Иметь актуальные данные для масштабирования системы

Достижение этих целей приведёт в конечном итоге к росту удовлетворённости клиентов, увеличению числа заказов, а с другой стороны к сокращению операционных расходов.
И как итог к росту прибыли компании.

Технические метрики на которые повлияет внедрение трейсинга:
- Number of HTTP 500 for API - ошибки будут более оперативно исправляться и в итоге среднее их количество будет сокращаться
- Response time (latency) for API - выявленные медленные этапы будут оптимизироваться в первую очередь и задержка будет уменьшаться
- Number of dead-letter-exchange letters in RabbitMQ - исправление ошибок также приведёт к сокращению числа потерянных сообщений в RabbitMQ

Бизнес метрики на которые повлияет внедрение трейсинга:
- Average Time to Resolution - ATR - так как этап на котором застрял заказ будет легко находить, то и в целом уменьшится время разрешения инцидентов
- Customer Retention Rate - уменьшение количества проблем и быстрое их решение будет способствовать удерожанию клиентов
- Operational Efficiency - оптимизация процесса поиска и устранения ошибок приведёт к сокращению операционных расходов
- время создания заказа
Также уменьшится количество потеряных заказов.
Всё это приведёт к увеличению объёмов продаж и, соответственно, к увеличению прибыли.

Предлагаемое решение

Нужно добавить в систему экземпляр Jaeger и внести изменения в коды сервисов для поддержки передачи данных трейсинга в jaeger: jewerly_c4_model.drawio

Реализация автоматического мониторинга процесса прохождения заказа: jewerly_c4_model_v2.drawio
Предлагаю добавить компонент, который будет периодически проверять статусы активных заказов и сравнивать время, которое заказ провёл в текущем статусе, с запланированным.
В качестве планируемого времени можно брать типовое и позволять операторам корректировать его индивидуально для каждого заказа при необходимости.
При превышении времени пребывания заказа в определённом статусе оператору, ответственному за заказ, будет отсылаться сообщение о просрочке.

Компромиссы

Так как предположительно заказы пропадают в системе MES -> RabbitMQ -> CRM, то значит в MES API и CRM API трейсинг надо добавить в первую очередь.
А добавление трейсинга Shop API можно на время записать в бэклог.

Аспекты безопасности

Для предотвращения несанкционированного доступа для компонента Jaeger UI нужно добавить аутентификацию и авторизацию.
Доступ предоставить операторам, администраторам и разработчикам.
Передачу данных трейсига в Jaeger организовать так, что бы передавалась только минимально необходимая инфоормация (например только идентификатор заказа), а клиентская и финансовая информация в Jaeger не попадала.
